import router from '@ohos.router';
import prompt from '@ohos.promptAction';

interface HistoryItem {
  id: string;
  title: string;
  author: string;
  summary: string;
  image: ResourceStr;
  viewTime: string;
  topic: string;
}

@Entry
@Component
struct HistoryPage {
  @State histories: HistoryItem[] = [
    {
      id: '1',
      title: 'è„¸ä¸Žèº«æä¸ç¬¦æ˜¯ç§æ€Žæ ·çš„ä½“éªŒï¼Ÿ',
      author: 'ç­”ä¸» Â· ä¸å€’æ–—çš„èƒ¡å…«ä¸€',
      summary: 'åˆåˆ°äº†è¿™åªå…”å…”å‡ºçŽ°çš„æ—¶å€™...',
      image: $r('app.media.thumb_801'),
      viewTime: '10åˆ†é’Ÿå‰',
      topic: 'ç”Ÿæ´»'
    },
    {
      id: '2',
      title: 'ä¸ºä»€ä¹ˆè¯´ç”·äººè‡³æ­»éƒ½æ˜¯å°‘å¹´ï¼Ÿ',
      author: 'ç­”ä¸» Â· å‘å‰',
      summary: 'ä¸ˆæ¯å¨˜å®¶å°åŒºæš–æ°”ç®¡çˆ†äº†,ä¸€å¤§æ—©åœ¨ä¿®...',
      image: $r('app.media.thumb_802'),
      viewTime: '30åˆ†é’Ÿå‰',
      topic: 'æƒ…æ„Ÿ'
    },
    {
      id: '3',
      title: 'æ–°èƒ½æºè½¦ç”µæ± æœªæ¥äº”å¹´çš„çªç ´ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ',
      author: 'ç­”ä¸» Â· é™ˆæ›¦',
      summary: 'å›ºæ€ç”µæ± ã€å¿«å……å®‰å…¨ã€å›žæ”¶ä¸Žæ¢¯æ¬¡åˆ©ç”¨',
      image: $r('app.media.thumb_803'),
      viewTime: '2å°æ—¶å‰',
      topic: 'èƒ½æº'
    },
    {
      id: '4',
      title: 'é‡å­è®¡ç®—è·ç¦»å•†ä¸šåŒ–è¿˜æœ‰å¤šè¿œï¼Ÿ',
      author: 'ç­”ä¸» Â· éƒ‘åŽ',
      summary: 'æŠ€æœ¯çªç ´ã€åº”ç”¨åœºæ™¯ã€æŠ•èµ„å‰æ™¯çš„å…¨é¢åˆ†æž',
      image: $r('app.media.thumb_804'),
      viewTime: 'æ˜¨å¤©',
      topic: 'é‡å­'
    },
    {
      id: '5',
      title: 'è‡ªåŠ¨é©¾é©¶æŠ€æœ¯çš„å®‰å…¨æ€§ä¸Žå¯é æ€§æŽ¢è®¨',
      author: 'ç­”ä¸» Â· é©¬è¶…',
      summary: 'ä¼ æ„Ÿå™¨èžåˆã€å†³ç­–ç®—æ³•ã€äº‹æ•…è´£ä»»ç­‰å…³é”®é—®é¢˜çš„æ·±åº¦è§£æž',
      image: $r('app.media.thumb_805'),
      viewTime: 'æ˜¨å¤©',
      topic: 'æ±½è½¦'
    }
  ];

  private clearHistory() {
    this.histories = [];
    prompt.showToast({ message: 'å·²æ¸…ç©ºæµè§ˆåŽ†å²' });
  }

  private removeItem(id: string) {
    this.histories = this.histories.filter((item: HistoryItem) => item.id !== id);
    prompt.showToast({ message: 'å·²åˆ é™¤' });
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(24)
          .fontColor('#333333')
          .padding({ left: 16, right: 16 })
          .onClick(() => router.back());

        Text('æµè§ˆåŽ†å²')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .layoutWeight(1);

        Text('æ¸…ç©º')
          .fontSize(14)
          .fontColor('#ff4d4f')
          .padding({ right: 16 })
          .onClick(() => this.clearHistory());
      }
      .width('100%')
      .height(56)
      .backgroundColor('#ffffff')
      .alignItems(VerticalAlign.Center);

      // åŽ†å²è®°å½•åˆ—è¡¨
      if (this.histories.length === 0) {
        Column({ space: 16 }) {
          Text('ðŸ“–')
            .fontSize(60);
          Text('æš‚æ— æµè§ˆè®°å½•')
            .fontSize(16)
            .fontColor('#999999');
          Text('ä½ æµè§ˆè¿‡çš„å†…å®¹ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ')
            .fontSize(13)
            .fontColor('#bbbbbb');
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .alignItems(HorizontalAlign.Center);
      } else {
        List({ space: 12 }) {
          ForEach(this.histories, (item: HistoryItem) => {
            ListItem() {
              Row({ space: 12 }) {
                Image(item.image)
                  .width(100)
                  .height(70)
                  .borderRadius(8)
                  .objectFit(ImageFit.Cover);

                Column({ space: 6 }) {
                  Text(item.title)
                    .fontSize(15)
                    .fontWeight(FontWeight.Medium)
                    .fontColor('#333333')
                    .maxLines(2)
                    .textOverflow({ overflow: TextOverflow.Ellipsis });

                  Text(item.author)
                    .fontSize(12)
                    .fontColor('#666666');

                  Row({ space: 8 }) {
                    Text(item.topic)
                      .fontSize(11)
                      .fontColor('#0f88eb')
                      .padding({ left: 6, right: 6, top: 2, bottom: 2 })
                      .backgroundColor('#eef5ff')
                      .borderRadius(4);
                    Text(item.viewTime)
                      .fontSize(11)
                      .fontColor('#999999');
                  }
                }
                .layoutWeight(1)
                .alignItems(HorizontalAlign.Start);

                Text('Ã—')
                  .fontSize(20)
                  .fontColor('#cccccc')
                  .onClick(() => this.removeItem(item.id));
              }
              .width('100%')
              .padding(12)
              .backgroundColor('#ffffff')
              .borderRadius(12)
              .onClick(() => {
                router.pushUrl({
                  url: 'pages/MainPages/DetailPage',
                  params: {
                    title: item.title,
                    author: item.author,
                    topic: item.topic,
                    summary: item.summary
                  }
                });
              });
            };
          });
        }
        .padding({ left: 16, right: 16, top: 12 })
        .layoutWeight(1);
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f5f5f5');
  }
}

