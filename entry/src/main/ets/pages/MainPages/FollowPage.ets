import router from '@ohos.router';
import prompt from '@ohos.promptAction';

interface FollowParams {
  type?: string; // 'following' æˆ– 'followers'
}

interface UserItem {
  id: string;
  name: string;
  avatar: ResourceStr;
  bio: string;
  isFollowing: boolean;
  followersCount: number;
  answersCount: number;
}

@Entry
@Component
struct FollowPage {
  @State type: string = 'following';
  @State followingList: UserItem[] = [
    {
      id: '1',
      name: 'æŽç„¶',
      avatar: $r('app.media.avatar_901'),
      bio: 'ç§‘æŠ€é¢†åŸŸåˆ›ä½œè€…ï¼Œå…³æ³¨AIä¸Žäº§ä¸šèžåˆ',
      isFollowing: true,
      followersCount: 12580,
      answersCount: 156
    },
    {
      id: '2',
      name: 'å¼ ä¼Ÿ',
      avatar: $r('app.media.avatar_902'),
      bio: 'å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œä¹äºŽåˆ†äº«ç¼–ç¨‹ç»éªŒ',
      isFollowing: true,
      followersCount: 8920,
      answersCount: 89
    }
  ];
  @State followersList: UserItem[] = [
    {
      id: '3',
      name: 'çŽ‹å°æ˜Ž',
      avatar: $r('app.media.avatar_903'),
      bio: 'å­¦ç”Ÿå…šï¼Œå–œæ¬¢å­¦ä¹ æ–°æŠ€æœ¯',
      isFollowing: false,
      followersCount: 120,
      answersCount: 5
    },
    {
      id: '4',
      name: 'åˆ˜èŠ³',
      avatar: $r('app.media.avatar_904'),
      bio: 'äº§å“ç»ç†ï¼Œå…³æ³¨ç”¨æˆ·ä½“éªŒ',
      isFollowing: true,
      followersCount: 560,
      answersCount: 23
    }
  ];

  aboutToAppear() {
    const params = router.getParams() as FollowParams;
    if (params && params.type) {
      this.type = params.type;
    }
  }

  private toggleFollow(list: UserItem[], index: number) {
    list[index].isFollowing = !list[index].isFollowing;
    const status = list[index].isFollowing ? 'å·²å…³æ³¨' : 'å·²å–æ¶ˆå…³æ³¨';
    prompt.showToast({ message: status });
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('â†')
          .fontSize(24)
          .fontColor('#333333')
          .padding({ left: 16, right: 16 })
          .onClick(() => router.back());

        Text(this.type === 'following' ? 'æˆ‘çš„å…³æ³¨' : 'æˆ‘çš„ç²‰ä¸')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')
          .layoutWeight(1);
      }
      .width('100%')
      .height(56)
      .backgroundColor('#ffffff')
      .alignItems(VerticalAlign.Center);

      // Tabåˆ‡æ¢
      Row() {
        Column() {
          Text('å…³æ³¨')
            .fontSize(16)
            .fontWeight(this.type === 'following' ? FontWeight.Bold : FontWeight.Normal)
            .fontColor(this.type === 'following' ? '#0f88eb' : '#666666');
          if (this.type === 'following') {
            Divider()
              .color('#0f88eb')
              .strokeWidth(2)
              .width(40)
              .margin({ top: 8 });
          }
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
        .padding({ top: 12, bottom: 12 })
        .onClick(() => {
          this.type = 'following';
        });

        Column() {
          Text('ç²‰ä¸')
            .fontSize(16)
            .fontWeight(this.type === 'followers' ? FontWeight.Bold : FontWeight.Normal)
            .fontColor(this.type === 'followers' ? '#0f88eb' : '#666666');
          if (this.type === 'followers') {
            Divider()
              .color('#0f88eb')
              .strokeWidth(2)
              .width(40)
              .margin({ top: 8 });
          }
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Center)
        .padding({ top: 12, bottom: 12 })
        .onClick(() => {
          this.type = 'followers';
        });
      }
      .width('100%')
      .backgroundColor('#ffffff')
      .border({ width: { bottom: 0.5 }, color: '#e8e8e8' });

      // ç”¨æˆ·åˆ—è¡¨
      if (this.type === 'following') {
        if (this.followingList.length === 0) {
          Column({ space: 16 }) {
            Text('ðŸ‘¥')
              .fontSize(60);
            Text('æš‚æ— å…³æ³¨')
              .fontSize(16)
              .fontColor('#999999');
          }
          .width('100%')
          .layoutWeight(1)
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center);
        } else {
          List({ space: 12 }) {
            ForEach(this.followingList, (user: UserItem, index: number) => {
              ListItem() {
                Row({ space: 12 }) {
                  Image(user.avatar)
                    .width(50)
                    .height(50)
                    .borderRadius(25)
                    .objectFit(ImageFit.Cover);

                  Column({ space: 4 }) {
                    Text(user.name)
                      .fontSize(16)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#333333');
                    Text(user.bio)
                      .fontSize(13)
                      .fontColor('#666666')
                      .maxLines(1)
                      .textOverflow({ overflow: TextOverflow.Ellipsis });
                    Row({ space: 12 }) {
                      Text(`${user.followersCount} ç²‰ä¸`)
                        .fontSize(12)
                        .fontColor('#999999');
                      Text(`${user.answersCount} å›žç­”`)
                        .fontSize(12)
                        .fontColor('#999999');
                    }
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start);

                  Button(user.isFollowing ? 'å·²å…³æ³¨' : '+ å…³æ³¨')
                    .height(32)
                    .backgroundColor(user.isFollowing ? '#f5f5f5' : '#0f88eb')
                    .fontColor(user.isFollowing ? '#666666' : '#ffffff')
                    .fontSize(13)
                    .borderRadius(16)
                    .onClick(() => this.toggleFollow(this.followingList, index));
                }
                .width('100%')
                .padding(16)
                .backgroundColor('#ffffff')
                .borderRadius(12)
                .onClick(() => {
                  router.pushUrl({
                    url: 'pages/MainPages/ProfilePage',
                    params: { userId: user.id, userName: user.name }
                  });
                });
              };
            });
          }
          .padding({ left: 16, right: 16, top: 12 })
          .layoutWeight(1);
        }
      } else {
        if (this.followersList.length === 0) {
          Column({ space: 16 }) {
            Text('ðŸ‘¥')
              .fontSize(60);
            Text('æš‚æ— ç²‰ä¸')
              .fontSize(16)
              .fontColor('#999999');
          }
          .width('100%')
          .layoutWeight(1)
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center);
        } else {
          List({ space: 12 }) {
            ForEach(this.followersList, (user: UserItem, index: number) => {
              ListItem() {
                Row({ space: 12 }) {
                  Image(user.avatar)
                    .width(50)
                    .height(50)
                    .borderRadius(25)
                    .objectFit(ImageFit.Cover);

                  Column({ space: 4 }) {
                    Text(user.name)
                      .fontSize(16)
                      .fontWeight(FontWeight.Medium)
                      .fontColor('#333333');
                    Text(user.bio)
                      .fontSize(13)
                      .fontColor('#666666')
                      .maxLines(1)
                      .textOverflow({ overflow: TextOverflow.Ellipsis });
                    Row({ space: 12 }) {
                      Text(`${user.followersCount} ç²‰ä¸`)
                        .fontSize(12)
                        .fontColor('#999999');
                      Text(`${user.answersCount} å›žç­”`)
                        .fontSize(12)
                        .fontColor('#999999');
                    }
                  }
                  .layoutWeight(1)
                  .alignItems(HorizontalAlign.Start);

                  Button(user.isFollowing ? 'å·²å…³æ³¨' : '+ å…³æ³¨')
                    .height(32)
                    .backgroundColor(user.isFollowing ? '#f5f5f5' : '#0f88eb')
                    .fontColor(user.isFollowing ? '#666666' : '#ffffff')
                    .fontSize(13)
                    .borderRadius(16)
                    .onClick(() => this.toggleFollow(this.followersList, index));
                }
                .width('100%')
                .padding(16)
                .backgroundColor('#ffffff')
                .borderRadius(12)
                .onClick(() => {
                  router.pushUrl({
                    url: 'pages/MainPages/ProfilePage',
                    params: { userId: user.id, userName: user.name }
                  });
                });
              };
            });
          }
          .padding({ left: 16, right: 16, top: 12 })
          .layoutWeight(1);
        }
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#f5f5f5');
  }
}

